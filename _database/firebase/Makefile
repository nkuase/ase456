# Firebase Student App - Development Commands
# Usage: make <command>

.PHONY: help setup clean test build run install lint format docs docker

# Default target
help:
	@echo "ğŸ”¥ Firebase Student App - Available Commands"
	@echo "============================================"
	@echo ""
	@echo "ğŸ“¦ Setup & Installation:"
	@echo "  make setup          Install all dependencies and configure project"
	@echo "  make install        Install Flutter dependencies"
	@echo "  make clean          Clean build artifacts and reset dependencies"
	@echo ""
	@echo "ğŸš€ Development:"
	@echo "  make run            Run the Flutter app (debug mode)"
	@echo "  make run-web        Run the Flutter web app"
	@echo "  make run-release    Run the Flutter app (release mode)"
	@echo "  make emulators      Start Firebase emulators"
	@echo "  make stop-emulators Stop Firebase emulators"
	@echo ""
	@echo "ğŸ§ª Testing:"
	@echo "  make test           Run all tests"
	@echo "  make test-unit      Run unit tests only"
	@echo "  make test-firebase  Run tests with Firebase emulators"
	@echo "  make test-coverage  Run tests with coverage report"
	@echo "  make test-performance Run performance tests"
	@echo ""
	@echo "ğŸ”§ Code Quality:"
	@echo "  make lint           Run dart analysis"
	@echo "  make format         Format code"
	@echo "  make format-check   Check code formatting"
	@echo "  make security       Run security analysis"
	@echo ""
	@echo "ğŸ“Š Build & Deploy:"
	@echo "  make build-android  Build Android APK"
	@echo "  make build-ios      Build iOS app"
	@echo "  make build-web      Build web app"
	@echo "  make build-all      Build for all platforms"
	@echo ""
	@echo "ğŸ“š Documentation:"
	@echo "  make docs           Generate documentation"
	@echo "  make docs-serve     Serve documentation locally"
	@echo ""
	@echo "ğŸ‹ Docker:"
	@echo "  make docker-build   Build Docker image"
	@echo "  make docker-run     Run app in Docker"
	@echo "  make docker-dev     Start development environment"
	@echo "  make docker-clean   Clean Docker resources"
	@echo ""
	@echo "ğŸ”— Utilities:"
	@echo "  make cli            Run CLI tools interactively"
	@echo "  make examples       Run example demonstrations"
	@echo "  make import-sample  Import sample data"
	@echo "  make backup         Create data backup"
	@echo "  make migrate        Run database migration tools"

# Setup and Installation
setup: clean install
	@echo "ğŸ”§ Setting up Firebase Student App..."
	@flutter doctor
	@echo "âœ… Setup complete! Run 'make run' to start the app."

install:
	@echo "ğŸ“¦ Installing Flutter dependencies..."
	@flutter pub get

clean:
	@echo "ğŸ§¹ Cleaning project..."
	@flutter clean
	@flutter pub get

# Development
run:
	@echo "ğŸš€ Starting Flutter app in debug mode..."
	@flutter run

run-web:
	@echo "ğŸŒ Starting Flutter web app..."
	@flutter run -d chrome --web-port 3000

run-release:
	@echo "ğŸš€ Starting Flutter app in release mode..."
	@flutter run --release

emulators:
	@echo "ğŸ”¥ Starting Firebase emulators..."
	@firebase emulators:start

stop-emulators:
	@echo "ğŸ›‘ Stopping Firebase emulators..."
	@firebase emulators:stop

# Testing
test:
	@echo "ğŸ§ª Running all tests..."
	@flutter test

test-unit:
	@echo "ğŸ§ª Running unit tests..."
	@flutter test test/unit/

test-firebase:
	@echo "ğŸ§ª Running tests with Firebase emulators..."
	@firebase emulators:exec --project demo-project "flutter test --dart-define=USE_FIREBASE_EMULATOR=true"

test-coverage:
	@echo "ğŸ“Š Running tests with coverage..."
	@flutter test --coverage
	@genhtml coverage/lcov.info -o coverage/html
	@echo "ğŸ“Š Coverage report generated in coverage/html/"

test-performance:
	@echo "âš¡ Running performance tests..."
	@dart lib/utils/cli_tools.dart test

# Code Quality
lint:
	@echo "ğŸ” Running dart analysis..."
	@flutter analyze

format:
	@echo "âœ¨ Formatting code..."
	@dart format lib/ test/

format-check:
	@echo "âœ… Checking code format..."
	@dart format --output=none --set-exit-if-changed lib/ test/

security:
	@echo "ğŸ”’ Running security analysis..."
	@flutter analyze --fatal-infos
	@echo "ğŸ”’ Checking for known vulnerabilities..."
	@flutter pub deps

# Build
build-android:
	@echo "ğŸ“± Building Android APK..."
	@flutter build apk --release

build-ios:
	@echo "ğŸ Building iOS app..."
	@flutter build ios --release --no-codesign

build-web:
	@echo "ğŸŒ Building web app..."
	@flutter build web --release

build-all: build-android build-ios build-web
	@echo "ğŸ—ï¸ Building for all platforms..."

# Documentation
docs:
	@echo "ğŸ“š Generating documentation..."
	@dart doc
	@echo "ğŸ“š Documentation generated in doc/api/"

docs-serve:
	@echo "ğŸ“š Serving documentation..."
	@cd doc/api && python3 -m http.server 8080

# Docker
docker-build:
	@echo "ğŸ‹ Building Docker image..."
	@docker build -t firebase-student-app .

docker-run:
	@echo "ğŸ‹ Running app in Docker..."
	@docker run -it --rm -p 3000:3000 -p 4000:4000 -p 8080:8080 firebase-student-app

docker-dev:
	@echo "ğŸ‹ Starting development environment..."
	@docker-compose up --build

docker-clean:
	@echo "ğŸ‹ Cleaning Docker resources..."
	@docker-compose down -v
	@docker system prune -f

# Utilities
cli:
	@echo "ğŸ’» Starting CLI tools..."
	@dart lib/utils/cli_tools.dart interactive

examples:
	@echo "ğŸ“‹ Running examples..."
	@dart lib/examples/firebase_examples.dart

import-sample:
	@echo "ğŸ“¥ Importing sample data..."
	@dart lib/utils/cli_tools.dart import sample_data/students.json

backup:
	@echo "ğŸ’¾ Creating backup..."
	@dart lib/utils/cli_tools.dart backup

migrate:
	@echo "ğŸ”„ Running migration tools..."
	@dart lib/utils/cli_tools.dart migrate firebase sqlite

# Quality Gates (for CI/CD)
quality-gate: lint format-check test-coverage security
	@echo "âœ… All quality checks passed!"

# Development workflow
dev-setup: setup emulators
	@echo "ğŸ‰ Development environment ready!"
	@echo "Open another terminal and run 'make run-web' to start the app"

# Production build
prod-build: clean lint test build-all
	@echo "ğŸš€ Production build complete!"

# Complete project validation
validate: clean install lint format-check test-coverage security build-all docs
	@echo "âœ… Project validation complete!"

# Quick development cycle
quick: format lint test
	@echo "âš¡ Quick development cycle complete!"

# Database operations
db-stats:
	@echo "ğŸ“Š Getting database statistics..."
	@dart lib/utils/cli_tools.dart stats

db-clean:
	@echo "ğŸ§¹ Cleaning test data..."
	@dart lib/utils/cli_tools.dart clean

# Performance monitoring
perf-monitor:
	@echo "ğŸ“ˆ Starting performance monitoring..."
	@dart lib/utils/cli_tools.dart test

# Educational commands
learn-firebase:
	@echo "ğŸ“ Firebase learning resources:"
	@echo "  1. Run 'make examples' to see comprehensive examples"
	@echo "  2. Check CONCEPTS.md for theoretical background"
	@echo "  3. Review README.md for setup instructions"
	@echo "  4. Explore lib/examples/ for code samples"

# Troubleshooting
doctor:
	@echo "ğŸ©º Running Flutter doctor..."
	@flutter doctor -v

troubleshoot: doctor
	@echo "ğŸ”§ Troubleshooting information:"
	@echo "Flutter version:"
	@flutter --version
	@echo ""
	@echo "Dependencies:"
	@flutter pub deps
	@echo ""
	@echo "Project status:"
	@flutter analyze --no-fatal-infos

# Version information
version:
	@echo "ğŸ“‹ Version Information:"
	@echo "Flutter: $(shell flutter --version | head -n 1)"
	@echo "Dart: $(shell dart --version)"
	@echo "Firebase CLI: $(shell firebase --version 2>/dev/null || echo 'Not installed')"
	@echo "Project: Firebase Student Management App v1.0.0"

# Environment check
env-check:
	@echo "ğŸ” Environment Check:"
	@echo "Flutter installed: $(shell which flutter > /dev/null && echo 'âœ…' || echo 'âŒ')"
	@echo "Dart installed: $(shell which dart > /dev/null && echo 'âœ…' || echo 'âŒ')"
	@echo "Firebase CLI installed: $(shell which firebase > /dev/null && echo 'âœ…' || echo 'âŒ')"
	@echo "Docker installed: $(shell which docker > /dev/null && echo 'âœ…' || echo 'âŒ')"
	@echo "Git installed: $(shell which git > /dev/null && echo 'âœ…' || echo 'âŒ')"

# Shorthand aliases
s: setup
r: run
t: test
l: lint
f: format
b: build-all
d: docs
c: clean
